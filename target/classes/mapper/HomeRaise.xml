<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.blogss.mapper.HomeRaiseMapper">
    <sql id="columns">raiseId,raiseCatId,farmId,raiseName,raiseThums,marketPrice,raiseCycle,raiseProfit,
    raiseStock,raisePeriod</sql>

    <!--总记录数-->
    <select id="totCount" resultType="int">
        SELECT count(*) from  raise
    </select>

    <!--农资分页查看-->
    <select id="raiseList" parameterType="int" resultType="Raise">
        select <include refid="columns"></include>
        from raise limit #{startPos},6
    </select>

    <!--农资分类分页产看-->
    <select id="raiseCatList"  resultType="Raise">
        select <include refid="columns"></include>
        from raise
        where raiseCatId = #{1}
        limit #{0},6
    </select>


    <!--农资详情-->
    <select id="raiseDetail" parameterType="int" resultType="Raise">
        select * from raise where raiseId = #{raiseId};
    </select>

    <!--农资类型-->
    <select id="catName" parameterType="int" resultType="String">
        select catName
        from raise_cat
        where raiseCatId = (select raiseCatId from raise where raiseId=#{raiseId})
    </select>

    <!--农资所有分类-->
    <select id="raiseCat" resultType="RaiseCat">
        select raiseCatId,catName from raise_cat;
    </select>

    <!--订单付款-->
    <insert id="raisePay" parameterType="RaiseOrders">
        insert into raise_orders(userId,raiseId,raiseMount,totalMoney,createTime,orderNum)
        values(#{userId},#{raiseId},#{raiseMount},#{totalMoney},#{createTime},#{orderNum});
    </insert>

    <!--订单完成之后需要更新农资的库存-->
    <update id="raiseStock" parameterType="Integer">
        update raise set raiseStock = raiseStock-#{raiseMount}
    </update>


</mapper>